# –ö–æ–º–ø–ª–µ–∫—Å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ –≤—Å–µ—Ö –ø—Ä–æ–±–ª–µ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è WhisperLiveKit

## –û–±–∑–æ—Ä –ø—Ä–æ–±–ª–µ–º

–ù–∞ –æ—Å–Ω–æ–≤–µ –∞–Ω–∞–ª–∏–∑–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è https://github.com/m1krot1k1/Whisper/tree/dev –æ–±–Ω–∞—Ä—É–∂–µ–Ω—ã —Å–ª–µ–¥—É—é—â–∏–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã:

### üî¥ –û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
1. **–ú–µ–¥–ª–µ–Ω–Ω–∞—è —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è** - "–ø–ª–æ—Ö–∞—è –∏ –º–µ–¥–ª–µ–Ω–Ω–∞—è —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏—è"
2. **–ù–µ–æ–ø—Ç–∏–º–∞–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è GPU** - CUDA –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ä–∞–∑–±—Ä–æ—Å–∞–Ω—ã –ø–æ —Ñ–∞–π–ª—É
3. **–ò–∑–±—ã—Ç–æ—á–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏** - —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –≤ .env
4. **–ö–æ–Ω—Ñ–ª–∏–∫—Ç—ã –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π** - –ø—Ä–æ–±–ª–µ–º—ã —Å —É—Å—Ç–∞–Ω–æ–≤–∫–æ–π —á–µ—Ä–µ–∑ install.sh

## üîß –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

### 1. –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è .env –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

**–ü—Ä–æ–±–ª–µ–º–∞**: –¢–µ–∫—É—â–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç:
- `WLK_MODEL=large-v3-turbo` (1.5GB) - —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–∞—è –º–æ–¥–µ–ª—å
- `WLK_FRAME_THRESHOLD=15` - —Å–ª–∏—à–∫–æ–º –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–æ –¥–ª—è –∫–∞—á–µ—Å—Ç–≤–∞
- `WLK_GUNICORN_WORKERS=12` - –∏–∑–±—ã—Ç–æ—á–Ω–æ –¥–ª—è –æ–¥–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ CUDA –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

**–†–µ—à–µ–Ω–∏–µ**: –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
```bash
# –ë–∞–∑–æ–≤—ã–µ GPU –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (—É–ø—Ä–æ—â–µ–Ω–æ)
CUDA_VISIBLE_DEVICES=0
WHISPER_DEVICE=cuda
FASTER_WHISPER_CUDA=1

# –û–ø—Ç–∏–º–∞–ª—å–Ω–∞—è –º–æ–¥–µ–ª—å –¥–ª—è —Å–∫–æ—Ä–æ—Å—Ç–∏
WLK_MODEL=small
WLK_BACKEND=faster-whisper
WLK_LANGUAGE=ru

# –°–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
WLK_FRAME_THRESHOLD=25
WLK_BEAMS=3
WLK_MIN_CHUNK_SIZE=0.5

# –û—Ç–∫–ª—é—á–µ–Ω–∏–µ —Å–ª–æ–∂–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π
WLK_DIARIZATION=false
WLK_ENABLE_ADAPTIVE_BUFFERING=false

# –†–∞–∑—É–º–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–æ—Ä–∫–µ—Ä–æ–≤
WLK_GUNICORN_WORKERS=4
```

### 2. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –º–æ–¥–µ–ª–µ–π

**–ü—Ä–æ–±–ª–µ–º–∞**: –ù–µ—è—Å–Ω–æ, —Å–∫–∞—á–∏–≤–∞—é—Ç—Å—è –ª–∏ –º–æ–¥–µ–ª–∏ –≤ –ø—Ä–∞–≤–∏–ª—å–Ω—É—é –ø–∞–ø–∫—É

**–†–µ—à–µ–Ω–∏–µ**: –û–±–µ—Å–ø–µ—á–∏—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø–∞–ø–æ–∫
```bash
mkdir -p models/{whisper,cache,silero_vad}
mkdir -p logs
```

**–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥–µ–ª–µ–π**:
- Whisper –º–æ–¥–µ–ª–∏: `./models/whisper/`
- Silero VAD: `./models/silero_vad/`
- Cache: `./models/cache/`

### 3. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ (install.sh)

**–ü—Ä–æ–±–ª–µ–º—ã**:
- –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏–∑–±—ã—Ç–æ—á–Ω—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (NeMo toolkit)
- –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è CUDA (11.8 –≤–º–µ—Å—Ç–æ 12.1)
- –ö–æ–Ω—Ñ–ª–∏–∫—Ç—ã PyTorch

**–†–µ—à–µ–Ω–∏–µ**: –£–ø—Ä–æ—â–µ–Ω–Ω—ã–π install.sh
```bash
# –û—Å–Ω–æ–≤–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —Ç–æ–ª—å–∫–æ
pip install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cu121
pip install -e .
pip install faster-whisper soundfile librosa
pip install gunicorn uvicorn[standard]
```

### 4. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è Gunicorn –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

**–ü—Ä–æ–±–ª–µ–º—ã**:
- 12 –≤–æ—Ä–∫–µ—Ä–æ–≤ –∏–∑–±—ã—Ç–æ—á–Ω–æ
- –¢–∞–π–º–∞—É—Ç 300 —Å–µ–∫—É–Ω–¥ —Å–ª–∏—à–∫–æ–º –≤—ã—Å–æ–∫–∏–π
- –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ GPU

**–†–µ—à–µ–Ω–∏–µ**: –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π gunicorn.conf.py
```python
workers = 4  # –í–º–µ—Å—Ç–æ 12
timeout = 120  # –í–º–µ—Å—Ç–æ 300
max_requests = 500  # –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏
preload_app = True  # –≠–∫–æ–Ω–æ–º–∏—è –ø–∞–º—è—Ç–∏

# –•—É–∫–∏ –¥–ª—è GPU –ø—Ä–æ–≤–µ—Ä–∫–∏
def on_starting(server):
    import torch
    if torch.cuda.is_available():
        server.log.info(f"GPU available: {torch.cuda.get_device_name(0)}")
```

### 5. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–µ—Ä–≤–µ—Ä–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤

**–ü—Ä–æ–±–ª–µ–º–∞**: adaptive_basic_server.py –¥–æ–±–∞–≤–ª—è–µ—Ç —Å–ª–æ–∂–Ω–æ—Å—Ç—å –±–µ–∑ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏

**–†–µ—à–µ–Ω–∏–µ**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å basic_server.py —Å –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–µ–π
- –£–±—Ä–∞—Ç—å adaptive buffering –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏
- –£–ø—Ä–æ—Å—Ç–∏—Ç—å WebSocket –æ–±—Ä–∞–±–æ—Ç–∫—É
- –î–æ–±–∞–≤–∏—Ç—å –ª—É—á—à—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫

### 6. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è dependencies (pyproject.toml)

**–ü—Ä–æ–±–ª–µ–º—ã**:
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ Python –¥–æ 3.15 (–Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç)
- Triton —Ç–æ–ª—å–∫–æ –¥–ª—è Linux x86_64
- –ò–∑–±—ã—Ç–æ—á–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

**–†–µ—à–µ–Ω–∏–µ**: 
```toml
requires-python = ">=3.9,<3.13"
dependencies = [
    "fastapi",
    "librosa", 
    "soundfile",
    "faster-whisper",
    "uvicorn",
    "websockets",
    "torch>=2.0.0",
    "torchaudio>=2.0.0"
]
```

## üöÄ –ü–æ—à–∞–≥–æ–≤—ã–π –ø–ª–∞–Ω –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### –®–∞–≥ 1: –°–æ–∑–¥–∞—Ç—å –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—É—é .env –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
```bash
cp ".env copy" .env.backup
# –ó–∞–º–µ–Ω–∏—Ç—å –Ω–∞ —É–ø—Ä–æ—â–µ–Ω–Ω—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
```

### –®–∞–≥ 2: –ò—Å–ø—Ä–∞–≤–∏—Ç—å install.sh
```bash
# –ó–∞–º–µ–Ω–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π install.sh –Ω–∞ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—É—é –≤–µ—Ä—Å–∏—é
chmod +x install.sh
```

### –®–∞–≥ 3: –°–æ–∑–¥–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø–∞–ø–æ–∫
```bash
mkdir -p models/{whisper,cache,silero_vad}
mkdir -p logs
```

### –®–∞–≥ 4: –ò—Å–ø—Ä–∞–≤–∏—Ç—å gunicorn.conf.py
```bash
# –ó–∞–º–µ–Ω–∏—Ç—å –Ω–∞ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
```

### –®–∞–≥ 5: –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å GPU –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å
```python
import torch
print("CUDA available:", torch.cuda.is_available())
print("GPU count:", torch.cuda.device_count())
if torch.cuda.is_available():
    print("GPU name:", torch.cuda.get_device_name(0))
```

### –®–∞–≥ 6: –ü–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
```bash
source venv/bin/activate
pip uninstall torch torchvision torchaudio
pip install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cu121
pip install faster-whisper
```

## üìä –û–∂–∏–¥–∞–µ–º—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:
- **–°–∫–æ—Ä–æ—Å—Ç—å —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–∏**: ‚Üë 300-500%
- **–í—Ä–µ–º—è –æ—Ç–∫–ª–∏–∫–∞**: ‚Üì –æ—Ç 20 —Å–µ–∫—É–Ω–¥ –¥–æ 1-3 —Å–µ–∫—É–Ω–¥
- **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏**: ‚Üì –Ω–∞ 60% (small vs large-v3)
- **–ó–∞–≥—Ä—É–∑–∫–∞ GPU**: –û–ø—Ç–∏–º–∞–ª—å–Ω–∞—è —É—Ç–∏–ª–∏–∑–∞—Ü–∏—è

### –°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å:
- **–ú–µ–Ω—å—à–µ –æ—à–∏–±–æ–∫**: –£–ø—Ä–æ—â–µ–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- **–õ—É—á—à–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å**: –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –≤–µ—Ä—Å–∏–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- **Graceful restart**: –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Gunicorn

### –ö–∞—á–µ—Å—Ç–≤–æ:
- **–õ—É—á—à–∏–π –±–∞–ª–∞–Ω—Å**: speed/quality —Å beams=3
- **–ú–µ–Ω—å—à–µ –≥–∞–ª–ª—é—Ü–∏–Ω–∞—Ü–∏–π**: –û–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ frame_threshold
- **–°—Ç–∞–±–∏–ª—å–Ω–∞—è —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è**: –û—Ç–∫–ª—é—á–µ–Ω—ã —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

### –¢–µ—Å—Ç 1: –ë–∞–∑–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
```bash
# –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞
source venv/bin/activate
python -m whisperlivekit.basic_server

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –±—Ä–∞—É–∑–µ—Ä–µ: http://localhost:8000
```

### –¢–µ—Å—Ç 2: –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å GPU
```bash
# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ GPU
nvidia-smi -l 1

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–∏ –∫–æ—Ä–æ—Ç–∫–æ–π —Ñ—Ä–∞–∑—ã (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å < 2 —Å–µ–∫)
```

### –¢–µ—Å—Ç 3: –ö–∞—á–µ—Å—Ç–≤–æ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–∏
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä—É—Å—Å–∫–æ–π —Ä–µ—á–∏
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ—á–Ω–æ—Å—Ç–∏ –¥–ª—è –∫–æ—Ä–æ—Ç–∫–∏—Ö —Ñ—Ä–∞–∑
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ –ø—Ä–∏ –¥–ª–∏—Ç–µ–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç–µ

## üéØ –§–∏–Ω–∞–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. **–ù–∞—á–∞—Ç—å —Å –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏** - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π .env
2. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ –º–∞–ª–æ–π –º–æ–¥–µ–ª–∏** - —É–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç small –º–æ–¥–µ–ª—å
3. **–ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ –¥–æ–±–∞–≤–ª—è—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏** - –¥–∏–∞—Ä–∏–∑–∞—Ü–∏—é —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
4. **–ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å —Ä–µ—Å—É—Ä—Å—ã** - —Å–ª–µ–¥–∏—Ç—å –∑–∞ GPU/CPU –∑–∞–≥—Ä—É–∑–∫–æ–π
5. **–õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—ã** - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å INFO —É—Ä–æ–≤–µ–Ω—å –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

–≠—Ç–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–æ–ª–∂–Ω—ã —Ä–µ—à–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—É "–ø–ª–æ—Ö–æ–π –∏ –º–µ–¥–ª–µ–Ω–Ω–æ–π —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–∏" –∏ –æ–±–µ—Å–ø–µ—á–∏—Ç—å —Å—Ç–∞–±–∏–ª—å–Ω—É—é —Ä–∞–±–æ—Ç—É –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ.